<div class="home-container">

  <!-- Users Panel -->
  <app-users class="users-panel" [ngClass]="{'dark-mode': isDarkMode}" [isDarkMode]="isDarkMode"></app-users>

  <!-- Posts Panel -->
  <div class="posts-panel" [ngClass]="{'dark-mode': isDarkMode}">

    <!-- Theme Toggle -->
    <i (click)="toggleTheme()" class="fa-solid fa-circle-half-stroke theme-icon"></i>

    <!-- Profile Section -->
    <div class="profile-panel" *ngIf="user">
      <div class="profile-left">
        <img [src]="user.avatar ? user.avatar : 'default-avatar.png'" [alt]="user.username" class="avatar" />
        <h2>{{ user.username }}</h2>
         <button class="follow-btn" *ngIf="user.id !== currentUserId">
            {{ user.isFollowed ? 'Unfollow' : 'Follow' }}
        </button>
      </div>
      <div class="profile-right">
        <div class="stats">
          <div>
            <strong style="color: rgb(99, 138, 232);">{{ user.postsCount }}3 </strong>
            <span>Posts</span>
          </div>
          <div>
            <strong  style="color: rgb(99, 138, 232);">{{ user.followersCount }}0 </strong>
            <span>Followers</span>
          </div>
          <div>
            <strong  style="color: rgb(99, 138, 232);">{{ user.followingCount }} 0 </strong>
            <span>Following</span>
          </div>
        </div>
        <p>{{ user.email }}</p>
      </div>
    </div>

    <!-- Post Creation Form (only for profile owner) -->
    <div class="post-form" *ngIf="user?.id === currentUserId">
      <input type="text" placeholder="Post title" [(ngModel)]="newPost.title" />
      <textarea placeholder="Post content" [(ngModel)]="newPost.content"></textarea>
      <button (click)="submitPost()">Post</button>
    </div>

    <!-- Posts Grid -->
    <div class="posts-grid">
      <div class="post-card" *ngFor="let post of posts">

        <!-- Post Header -->
        <div class="post-header">
          <img [src]="post.avatar ? post.avatar : 'default-avatar.png'" alt="{{ post.author }}" />
          <span>{{ post.author }}</span>
        </div>

        <!-- Post Title -->
        <div *ngIf="!post.isEditing; else editTitle">
          <h5>{{ post.title }}</h5>
        </div>
        <ng-template #editTitle>
          <input [(ngModel)]="post.title" class="edit-input" />
        </ng-template>

        <!-- Post Content -->
        <div *ngIf="!post.isEditing; else editContent">
          <p>{{ post.content }}</p>
        </div>
        <ng-template #editContent>
          <textarea [(ngModel)]="post.content" class="edit-textarea"></textarea>
        </ng-template>

        <!-- Like + Comment -->
        <div class="post-actions">
          <i class="fa-heart"
            [ngClass]="post.liked ? 'fa-solid text-red-500' : 'fa-regular'"
            (click)="toggleLike(post)">
          </i>
          <span>{{ post.likes }}</span>

          <i class="fa-regular fa-comment" (click)="goToComments(post.id)"></i>
        </div>

        <!-- Post Buttons -->
        <div class="post-buttons">
          <ng-container *ngIf="post.authorId === currentUserId; else reportOnly">
            <i *ngIf="!post.isEditing" (click)="enableEdit(post, $event)" class="fa-solid fa-pen"></i>
            <i *ngIf="post.isEditing" (click)="savePost(post, $event); stopEvent($event)" class="fa-solid fa-save"></i>
            <i (click)="deletePost(post)" class="fas fa-trash"></i>
          </ng-container>
          <ng-template #reportOnly>
            <i (click)="reportPost(post)" class="fa-solid fa-triangle-exclamation"></i>
          </ng-template>
        </div>

      </div>
    </div>
  </div>

</div>
