<div class="home-container">
  <div class="article-panel" [ngClass]="{'dark-mode': isDarkMode}">
    <article class="article-container" *ngIf="post">
      <header class="article-header">
        <div *ngIf="showError" class="error-box">
          <span>{{ errorMessage }}</span>
        </div>
        <h1 *ngIf="!post.isEditing; else editTitle" class="article-title">
          {{ post.title }}
        </h1>
        <ng-template #editTitle>
          <input [(ngModel)]="post.title" class="title-edit-input" placeholder="Title" />
        </ng-template>

        <div class="author-section">
          <div class="author-info">
            <a [routerLink]="['/profile', post.authorId]">
              <img [src]="post.avatar ? post.avatar : 'default-avatar.png'" alt="{{post.author}}" class="author-avatar">
            </a>
            <div class="author-details">
              <span class="author-name">{{ post.author }}</span>
              <div class="article-meta">
                <span class="read-time">{{ post.createdAT | timeAgo }} </span>
                <span class="separator">Â·</span>
                <span class="publish-date">{{ post.createdAT | date:'yyyy-MM-dd' }}</span>
              </div>
            </div>
          </div>

          <div class="header-actions">
            <ng-container *ngIf="post.authorId === currentUserId; ">
              <button class="icon-btn" *ngIf="!post.isEditing" (click)="editPost(post, $event)" title="Edit">
                <i class="fa-solid fa-pen"></i>
              </button>
              <button class="icon-btn save-btn" *ngIf="post.isEditing" (click)="savePost(post, $event)" title="Save">
                <i class="fa-solid fa-check"></i>
              </button>
              <button class="icon-btn save-btn" *ngIf="post.isEditing" (click)="cancelEdit(post)" title="Cancel">
                <i class="fa-solid fa-xmark"></i>
              </button>
            </ng-container>
            
          </div>
        </div>
      </header>

      <div *ngIf="post.mediaUrls && post.mediaUrls.length > 0" class="media-slider">
        <button 
          *ngIf="post.mediaUrls.length > 1" 
          class="slider-control prev" 
          (click)="prevMedia()">
          <i class="fa-solid fa-chevron-left"></i>
        </button>

        <div class="media-content">
          <ng-container *ngFor="let mediaUrl of post.mediaUrls; let i = index">
            
            <div *ngIf="i === currentMediaIndex" class="media-item">
              <ng-container [ngSwitch]="getMediaType(mediaUrl)">
                <div *ngSwitchCase="'image'" class="featured-image">
                  <img [src]="mediaUrl" alt="Article featured image" />
                </div>
                <div *ngSwitchCase="'video'" class="featured-video">
                  <video controls [src]="mediaUrl"></video>
                </div>
              </ng-container>
            </div>
          </ng-container>
          
          <div *ngIf="post.isEditing" class="edit-media-overlay">
             <button class="icon-btn change-media-btn" title="Change Media" (click)="changeMedia(post)">
              <i class="fa-solid fa-image"></i> Change Media
            </button>
          </div>
        </div>

        <button 
          *ngIf="post.mediaUrls.length > 1" 
          class="slider-control next" 
          (click)="nextMedia()">
          <i class="fa-solid fa-chevron-right"></i>
        </button>
        
        <div *ngIf="post.mediaUrls.length > 1" class="media-index-indicator">
          {{ currentMediaIndex + 1 }} / {{ post.mediaUrls.length }}
        </div>
      </div>
      <div class="article-content">
        <div *ngIf="!post.isEditing; else editContent" class="content-text">
          <p>{{ post.content }}</p>
        </div>
        <ng-template #editContent>
          <textarea [(ngModel)]="post.content" class="content-edit-textarea" placeholder="Tell your story..."></textarea>
        </ng-template>
      </div>

      <footer class="article-footer">
        <div class="footer-actions">
          <button class="engagement-btn large" (click)="toggleLike(post)">
            <i class="fa-heart" [ngClass]="post.liked ? 'fa-solid text-red-500' : 'fa-regular'"></i>
            <span>{{ post.likes || 0 }}</span>
          </button>
          <button class="engagement-btn large" (click)="goToComments(post.id)">
            <i class="fa-solid fa-comment"></i>
            <span id="nn">Respond</span>
          </button>
        </div>
      </footer>
    </article>
  </div>
</div>