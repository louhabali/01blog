<div class="admin-dashboard">
  <!-- STATS PANEL -->
  <aside class="stats-panel">
    <div class="stat-card">
      <h2>Stats Overview</h2>
    </div>
    <div class="stat-card">
      <i class="fas fa-users"></i>
      <div>
        <h3>{{ usersCount }}</h3>
        <p>Total Users</p>
      </div>
    </div>
    <div class="stat-card">
      <i class="fas fa-user-slash"></i>
      <div>
        <h3>{{ bannedUsersCount }}</h3>
        <p>Banned</p>
      </div>
    </div>
    <div class="stat-card">
      <i class="fas fa-file-alt"></i>
      <div>
        <h3>{{ postsCount }}</h3>
        <p>Posts</p>
      </div>
    </div>
    <div class="stat-card">
      <i class="fas fa-eye-slash"></i>
      <div>
        <h3>{{ hiddenPostsCount }}</h3>
        <p>Hidden Posts</p>
      </div>
    </div>
  </aside>

  <!-- TABLES PANEL -->
  <main class="tables-panel">
    <!-- USERS -->
     
    <section class="table-section">
      <h2>Users</h2>
      <div class="table-scroll-wrapper" (scroll)="onUsersScroll($event)">
        <div class="table-scroll-inner">
          <table class="admin-table">
            <thead>
              <tr>
                <th>ID</th>
                <th>Username</th>
                <th>Email</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <ng-container *ngFor="let u of users">
                <tr *ngIf="u.role !== 'ADMIN'">
                  <td><a [routerLink]="['/profile', u.id]" class="link">{{ u.id }}</a></td>
                  <td><a [routerLink]="['/profile', u.id]" class="link">{{ u.username }}</a></td>
                  <td class="email">{{ u.email }}</td>
                  <td  [class.active]="u.enabled" [class.banned]="!u.enabled">
                    {{ u.enabled ? 'Active' : 'Banned' }}
                  </td>
                  <td class="actions">
                    <i class="fas" [ngClass]="u.enabled ? 'fa-user-slash' : 'fa-user-check'"
                       (click)="toggleBan(u)" title="Toggle ban"></i>
                    <i class="fas fa-trash" (click)="deleteUser(u)" title="Delete user"></i>
                  </td>
                </tr>
              </ng-container>
            </tbody>
          </table>
          <div *ngIf="loadingUsers" class="loading">Loading more...</div>
        </div>
      </div>
    </section>

    <!-- POSTS -->
    <section class="table-section">
      <h2>Posts</h2>
      <div class="table-scroll-wrapper" (scroll)="onPostsScroll($event)">
        <div class="table-scroll-inner">
          <table class="admin-table">
            <thead>
              <tr>
                <th>ID</th>
                <th>Author</th>
                <th>Title</th>
                <th>Status</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let p of posts">
                <td>{{ p.id }}</td>
                <td>
                  <a [routerLink]="['/profile', p.user.id]" class="link">{{ p.user.username }}</a>
                </td>
                <td class="title">{{ p.title | slice:0:10 }}...</td>
                <td [class.hidden]="!p.appropriate">
                  {{ p.appropriate ? 'Visible' : 'Hidden' }}
                </td>
                <td class="actions">
                  <!-- View post -->
                  <i class="fas fa-up-right-from-square" (click)="navigateToPost(p.id)" title="View post"></i>
                  <!-- Hide / Unhide -->  
                  <i class="fas"
                     [ngClass]="p.appropriate ? 'fa-eye-slash' : 'fa-eye'"
                     (click)="hidePost(p)" title="Hide / Unhide post"></i>
                  <!-- Delete -->
                  <i class="fas fa-trash" (click)="deletePost(p)" title="Delete post"></i>
                </td>
              </tr>
            </tbody>
          </table>
          <div *ngIf="loadingPosts" class="loading">Loading more...</div>
        </div>
      </div>
    </section>

    <!-- REPORTS -->
    <section class="table-section">
      <h2>Reports</h2>
      <div class="table-scroll-wrapper" (scroll)="onReportsScroll($event)">
        <div class="table-scroll-inner">
          <table class="admin-table">
            <thead>
              <tr>
                <th>ID</th>
                <th>Post</th>
                <th>reported user</th>
                <th>Reason</th>
                <th>Description</th>
                <th>reveived</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let r of reports">
                <td>{{ r.id }}</td>
                <td>
                  <a [routerLink]="['/posts', r.post.id]" class="link">
                    {{ r.post.id}}
                  </a>
                </td>
                <td>
                  <a [routerLink]="['/profile', r.post.user.id]" class="link">{{ r.post.user.username }}</a>
                </td>
                <td class="reason">{{ r.reason }}</td>
                <td class="reason">{{ r.description }}</td>
                <td class="reason">{{ r.createdAt | timeAgo }}</td>
                <td class="actions">
                  <i class="fas fa-check" (click)="resolveReport(r)" title="Resolve report"></i>
                  <i class="fas fa-trash" (click)="deletePostFromReport(r.post.id)" title="Delete post"></i>
                </td>
              </tr>
            </tbody>
          </table>
          <div *ngIf="loadingReports" class="loading">Loading more...</div>
        </div>
      </div>
    </section>
  </main>
</div>
<!-- Confirmation Modal -->
<div class="confirm-overlay" *ngIf="showConfirm">
  <div class="confirm-box">
    <p>{{ confirmMessage }}</p>
    <div class="confirm-actions">
      <button class="confirm-btn yes" (click)="confirmDelete()">Yes</button>
      <button class="confirm-btn no" (click)="closeConfirm()">No</button>
    </div>
  </div>
</div>

