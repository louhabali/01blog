<div class="home-container">

  <!-- CENTER: Comments Feed & Form -->
  <div class="posts-panel" #scrollContainer (scroll)="onScroll($event)">

    <!-- üîô Back Button -->
    <div class="back-button-container" *ngIf="postId">
      <a [routerLink]="['/posts', postId]" class="back-button">
        ‚Üê Back to Post
      </a>
    </div>

    <!-- Comment Form -->
    <div class="post-form">
      <textarea class="content-input" placeholder="Write a comment..." [(ngModel)]="newComment"></textarea>
      <div class="form-actions">
        <button class="publish-btn" (click)="addComment()">Publish</button>
      </div>
    </div>

    <!-- Comments Feed -->
    <div class="posts-feed">
      <div class="post-card" *ngFor="let comment of comments">
        <div class="post-header">
          <div class="author-info">
            <img class="avatar" [src]="comment.user.avatar || 'assets/default-avatar.png'" alt="avatar">
            <span class="author-name">{{ comment.user.username }}</span>
          </div>
          <small>{{ comment.createdAt | timeAgo }}</small>
        </div>

        <div class="post-body">
          <div class="post-text">
            <!-- ‚úÖ Editing mode -->
            <textarea *ngIf="editingCommentId === comment.id"
                      [(ngModel)]="editedContent"
                      class="edit-input"></textarea>

            <!-- ‚úÖ Normal mode -->
            <p *ngIf="editingCommentId !== comment.id"
               class="post-content">{{ comment.content }}</p>
          </div>

          <!-- ‚úÖ Edit/Delete icons only for the current user's comments -->
          <div class="comment-actions" *ngIf="comment.user.id === currentUserId">
            <button *ngIf="editingCommentId !== comment.id"
                    class="icon-btn edit"
                    (click)="startEdit(comment)"
                    title="Edit">
              <i class="fas fa-pen"></i>
            </button>
            <button *ngIf="editingCommentId !== comment.id"
                    class="icon-btn delete"
                    (click)="deleteComment(comment.id)"
                    title="Delete">
              <i class="fas fa-trash"></i>
            </button>

            <!-- ‚úÖ Save/Cancel buttons -->
            <div *ngIf="editingCommentId === comment.id" class="edit-actions">
              <button class="save-btn" (click)="saveEdit(comment)" title="Save">
                <i class="fas fa-save"></i> 
              </button>
              <button class="cancel-btn" (click)="cancelEdit()" title="Cancel">
                <i class="fas fa-times"></i> 
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- No comments -->
      <div *ngIf="comments.length === 0" class="no-posts">
        <p>No comments yet.</p>
      </div>
    </div>
  </div>
</div>
